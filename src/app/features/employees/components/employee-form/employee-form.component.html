<button mat-stroked-button color="primary" routerLink="/employee" style="margin-bottom: 16px;">
  一覧へ戻る
</button>
<div style="margin-bottom: 16px;">
  <div>企業ID：{{ companyId }}</div>
  <div>企業名：{{ companyName }}</div>
</div>
<h2 style="margin-top: 0; margin-bottom: 24px; text-align: center;">従業員追加</h2>
<div *ngIf="validationErrors.length > 0" class="validation-errors" style="color: red; margin-bottom: 16px;">
  <ul>
    <li *ngFor="let err of validationErrors">{{ err }}</li>
  </ul>
</div>
<form [formGroup]="form" (ngSubmit)="onSubmit()" class="employee-form">
  <mat-tab-group [(selectedIndex)]="selectedTabIndex" (selectedIndexChange)="onTabChange($event)">
    <!-- 基本情報 -->
    <mat-tab label="基本情報">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-item">
            <label>従業員ID</label>
            <input formControlName="employeeId" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>姓</label>
            <input formControlName="lastName" />
          </div>
          <div class="form-item">
            <label>名</label>
            <input formControlName="firstName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>姓（カナ）</label>
            <input formControlName="lastNameKana" />
          </div>
          <div class="form-item">
            <label>名（カナ）</label>
            <input formControlName="firstNameKana" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>生年月日</label>
            <input type="date" formControlName="birthday" />
          </div>
          <div class="form-item">
            <label>性別</label>
            <select formControlName="gender">
              <option value="">選択してください</option>
              <option *ngFor="let g of genderTypes" [value]="g.code">{{ g.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>マイナンバー</label>
            <input formControlName="myNumber" maxlength="12" />
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-raised-button color="primary" type="button" (click)="goToNextTab()">次へ</button>
      </div>
    </mat-tab>
    <!-- 雇用情報 -->
    <mat-tab label="雇用情報">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-item">
            <label>事業所名</label>
            <input formControlName="officeName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>部署</label>
            <input formControlName="department" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>役職</label>
            <input formControlName="position" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>雇用形態</label>
            <select formControlName="employeeType">
              <option value="">選択してください</option>
              <option *ngFor="let t of employeeTypes" [value]="t.code">{{ t.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>勤務形態</label>
            <select formControlName="workStyle">
              <option value="">選択してください</option>
              <option *ngFor="let t of workStyleTypes" [value]="t.code">{{ t.name }}</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>契約開始日</label>
            <input type="date" formControlName="contractStartDate" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>契約終了日</label>
            <input type="date" formControlName="contractEndDate" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>退職理由</label>
            <input formControlName="resignationReason" />
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-button type="button" (click)="goToPrevTab()">前へ</button>
        <button mat-raised-button color="primary" type="button" (click)="goToNextTab()">次へ</button>
      </div>
    </mat-tab>
    <!-- 連絡先 -->
    <mat-tab label="連絡先">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-item">
            <label>Email</label>
            <input formControlName="email" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>電話番号</label>
            <input formControlName="phoneNumber" />
          </div>
        </div>
        <div class="form-row" formGroupName="address">
          <div class="form-item">
            <label>郵便番号</label>
            <input formControlName="postalCode" />
          </div>
        </div>
        <div class="form-row" formGroupName="address">
          <div class="form-item">
            <label>都道府県</label>
            <input formControlName="prefecture" />
          </div>
        </div>
        <div class="form-row" formGroupName="address">
          <div class="form-item">
            <label>市区町村</label>
            <input formControlName="city" />
          </div>
        </div>
        <div class="form-row" formGroupName="address">
          <div class="form-item">
            <label>町域・番地</label>
            <input formControlName="town" />
          </div>
        </div>
        <div class="form-row" formGroupName="address">
          <div class="form-item">
            <label>建物名</label>
            <input formControlName="streetAddress" />
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-button type="button" (click)="goToPrevTab()">前へ</button>
        <button mat-raised-button color="primary" type="button" (click)="goToNextTab()">次へ</button>
      </div>
    </mat-tab>
    <!-- 社会保険情報 -->
    <mat-tab label="社会保険情報">
      <div class="form-grid insurance-grid">
        <div class="form-row">
          <div class="form-item" style="align-items: center;">
            <label><input type="checkbox" formControlName="isHealthInsuranceApplicable" /> 健康保険適用</label>
          </div>
          <div class="form-item">
            <label>健康保険被保険者番号</label>
            <input formControlName="healthInsuranceNumber" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item" style="align-items: center;">
            <label><input type="checkbox" formControlName="isPensionApplicable" /> 厚生年金適用</label>
          </div>
          <div class="form-item">
            <label>厚生年金被保険者番号</label>
            <input formControlName="pensionNumber" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item" style="align-items: center;">
            <label><input type="checkbox" formControlName="isEmploymentInsuranceApplicable" /> 雇用保険適用</label>
          </div>
          <div class="form-item">
            <label>雇用保険被保険者番号</label>
            <input formControlName="employmentInsuranceNumber" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label><input type="checkbox" formControlName="isCareInsuranceApplicable" readonly /> 介護保険適用（自動判定）</label>
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-button type="button" (click)="goToPrevTab()">前へ</button>
        <button mat-raised-button color="primary" type="button" (click)="goToNextTab()">次へ</button>
      </div>
    </mat-tab>
    <!-- 緊急連絡先と扶養 -->
    <mat-tab label="緊急連絡先と扶養">
      <div class="form-grid">
        <!-- 緊急連絡先ブロック -->
        <div class="form-row">
          <h3 style="margin-bottom: 0;">緊急連絡先</h3>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>氏名</label>
            <input formControlName="emergencyContactName" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>続柄</label>
            <input formControlName="emergencyContactRelationship" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>電話番号</label>
            <input formControlName="emergencyContactPhone" />
          </div>
        </div>
        
        <!-- 扶養情報ブロック -->
        <div class="form-row">
          <h3 style="margin-bottom: 0;">扶養情報</h3>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label><input type="checkbox" formControlName="hasDependents" /> 扶養家族あり</label>
          </div>
        </div>
        <div *ngIf="form.get('hasDependents')?.value">
          <div formArrayName="dependents">
            <div *ngFor="let dep of dependents.controls; let i = index" [formGroupName]="i" class="dependent-block">
              <div class="form-row">
                <div class="form-item">
                  <label>姓</label>
                  <input formControlName="lastName" />
                </div>
                <div class="form-item">
                  <label>名</label>
                  <input formControlName="firstName" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>姓（カナ）</label>
                  <input formControlName="lastNameKana" />
                </div>
                <div class="form-item">
                  <label>名（カナ）</label>
                  <input formControlName="firstNameKana" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>続柄</label>
                  <input formControlName="relationship" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>続柄コード</label>
                  <select formControlName="relationshipCode">
                    <option value="">選択してください</option>
                    <option value="01">配偶者</option>
                    <option value="02">子</option>
                    <option value="03">父母</option>
                    <option value="04">その他</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>生年月日</label>
                  <input type="date" formControlName="birthday" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>マイナンバー</label>
                  <input formControlName="myNumber" maxlength="12" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isSpouse" /> 配偶者</label>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isChild" /> 子供</label>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isDisabled" /> 障害者</label>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isStudent" /> 学生</label>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isLivingTogether" /> 同居</label>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>年収</label>
                  <input type="number" formControlName="income" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>被扶養者認定日</label>
                  <input type="date" formControlName="certificationDate" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>認定区分</label>
                  <select formControlName="certificationType">
                    <option value="">選択してください</option>
                    <option value="A">A区分</option>
                    <option value="B">B区分</option>
                    <option value="C">C区分</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>資格喪失日</label>
                  <input type="date" formControlName="lossDate" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label>備考</label>
                  <input formControlName="remarks" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-item">
                  <label><input type="checkbox" formControlName="isActive" /> 現役</label>
                </div>
                <button type="button" (click)="removeDependent(i)">削除</button>
              </div>
            </div>
            <button type="button" (click)="addDependent()">扶養家族を追加</button>
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-button type="button" (click)="goToPrevTab()">前へ</button>
        <button mat-raised-button color="primary" type="button" (click)="goToNextTab()">次へ</button>
      </div>
    </mat-tab>
    <!-- その他 -->
    <mat-tab label="その他">
      <div class="form-grid">
        <div class="form-row">
          <div class="form-item">
            <label><input type="checkbox" formControlName="isForeignWorker" /> 外国人労働者</label>
          </div>
        </div>
        <div *ngIf="form.get('isForeignWorker')?.value" [formGroup]="foreignWorker">
          <div class="form-row">
            <div class="form-item">
              <label>氏名（ローマ字）</label>
              <input formControlName="romanName" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>国籍</label>
              <input formControlName="nationality" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>在留資格</label>
              <input formControlName="residenceStatus" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>在留資格の種類</label>
              <input formControlName="residenceStatusType" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>在留カード番号</label>
              <input formControlName="residenceCardNumber" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>在留資格の有効期限</label>
              <input type="date" formControlName="residenceCardExpiry" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>在留資格の更新履歴</label>
              <input formControlName="residenceStatusHistory" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>パスポート番号</label>
              <input formControlName="passportNumber" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>パスポート有効期限</label>
              <input type="date" formControlName="passportExpiry" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasResidenceCardCopy" /> 在留カード写しの有無</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasSpecialExemption" /> 社会保険の免除特例の有無</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>免除特例の理由</label>
              <input formControlName="exemptionReason" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>雇用開始日</label>
              <input type="date" formControlName="employmentStartDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>雇用契約終了日</label>
              <input type="date" formControlName="employmentEndDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasSpecificActivity" /> 特定活動の有無</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>帰国予定日</label>
              <input type="date" formControlName="returnPlannedDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>備考</label>
              <input formControlName="remarks" />
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-item">
            <label><input type="checkbox" formControlName="isExtraordinaryLeave" /> 休職特例（産休・育休・介護等）</label>
          </div>
        </div>
        <div *ngIf="form.get('isExtraordinaryLeave')?.value" [formGroup]="extraordinaryLeave">
          <div class="form-row">
            <div class="form-item">
              <label>休職区分</label>
              <select formControlName="leaveTypeCode">
                <option value="">選択してください</option>
                <option *ngFor="let t of extraordinaryLeaveTypes" [value]="t.code">{{ t.label }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>休職開始日</label>
              <input type="date" formControlName="leaveStartDate" />
            </div>
            <div class="form-item">
              <label>休職終了日</label>
              <input type="date" formControlName="leaveEndDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>復職予定日</label>
              <input type="date" formControlName="returnPlanDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label>休職理由</label>
              <input formControlName="leaveReason" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="isInsuranceExempted" /> 社会保険料免除対象</label>
            </div>
            <div class="form-item">
              <label><input type="checkbox" formControlName="isEmploymentBenefit" /> 雇用保険給付対象</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="isSalaryPaid" /> 給与支給有無</label>
            </div>
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasWorkRestriction" /> 就労制限有無</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasMedicalCertificate" /> 医師の診断書有無</label>
            </div>
            <div class="form-item">
              <label><input type="checkbox" formControlName="hasSpecialExemption" /> 特例適用有無</label>
            </div>
          </div>
          
        </div>
        <div class="form-row">
          <div class="form-item">
            <label>備考</label>
            <textarea formControlName="remarks"></textarea>
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button mat-button type="button" (click)="goToPrevTab()">前へ</button>
        <button mat-raised-button color="accent" type="submit">保存</button>
      </div>
    </mat-tab>
  </mat-tab-group>
</form>

