<h2>社会保険料 詳細</h2>

<!-- 従業員切り替えセレクター -->
<div class="form-row">
  <label>従業員</label>
  <select [(ngModel)]="selectedEmployeeId" (ngModelChange)="onEmployeeChange()">
    <option *ngFor="let emp of employees" [value]="emp.employeeId">{{ emp.lastName }} {{ emp.firstName }}</option>
  </select>
</div>

<!-- プロフィールカード -->
<div class="profile-card" *ngIf="employeeInfo">
  <div class="avatar">{{ employeeInfo.lastName[0] }}{{ employeeInfo.firstName[0] }}</div>
  <div class="profile-main">
    <div class="name">{{ employeeInfo.lastName }} {{ employeeInfo.firstName }}</div>
    <div class="id">従業員番号: {{ employeeInfo.employeeId }}</div>
    <div class="office">{{ employeeInfo.officeName }}</div>
    <div class="birth">生年月日: {{ employeeInfo.birthday | date:'yyyy-MM-dd' }}</div>
    <div class="contract">契約開始日: {{ employeeInfo.contractStartDate || 'ー' }}</div>
  </div>
</div>

<!-- 保険適用状況 -->
<div class="insurance-status-row" *ngIf="employeeInfo">
  <div class="insurance-card" [class.active]="employeeInfo.healthInsuranceStatus?.isApplicable">
    <span class="icon health"></span> 健康保険
  </div>
  <div class="insurance-card" [class.active]="employeeInfo.pensionStatus?.isApplicable">
    <span class="icon pension"></span> 厚生年金
  </div>
  <div class="insurance-card" [class.active]="employeeInfo.isCareInsuranceApplicable">
    <span class="icon care"></span> 介護保険
  </div>
</div>

<!-- 現在の保険等級・計算根拠 -->
<div class="grade-cards">
  <div class="grade-card current">
    <h3>現在適用中の保険等級</h3>
    <ng-container *ngIf="currentInsuranceInfo; else noCurrent">
      <div>等級: {{ currentInsuranceInfo.healthGrade }}（{{ currentInsuranceInfo.pensionGrade }}）</div>
      <div>月額: {{ currentInsuranceInfo.healthMonthly | currency:'JPY':'symbol':'1.0-0' }}（{{ currentInsuranceInfo.pensionMonthly | currency:'JPY':'symbol':'1.0-0' }}）</div>
      <div>適用年月: {{ currentInsuranceInfo.applyYearMonth }}</div>
      <div>適用都道府県: {{ currentInsuranceInfo.prefectureName }}</div>
      <div>健康保険料率: {{ currentInsuranceInfo.healthRate }}%</div>
      <div>介護保険料率: {{ currentInsuranceInfo.careRate }}%</div>
      <div>厚生年金保険料率: {{ currentInsuranceInfo.pensionRate }}%</div>
      <div>算出根拠: {{ currentInsuranceInfo.basisText || 'ー' }}</div>
    </ng-container>
    <ng-template #noCurrent><div>該当なし</div></ng-template>
  </div>
</div>

<!-- 適用履歴テーブル -->
<div class="history-table">
  <h3>保険料適用履歴</h3>
  <table *ngIf="insuranceHistoryList.length > 0">
    <thead>
      <tr>
        <th>適用年月</th>
        <th>等級</th>
        <th>月額</th>
        <th>健康保険料率</th>
        <th>介護保険料率</th>
        <th>厚生年金保険料率</th>
        <th>適用都道府県</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let h of insuranceHistoryList">
        <td>{{ h.applyYearMonth }}</td>
        <td>{{ h.healthGrade }}（{{ h.pensionGrade }}）</td>
        <td>{{ h.healthMonthly | currency:'JPY':'symbol':'1.0-0' }}（{{ h.pensionMonthly | currency:'JPY':'symbol':'1.0-0' }}）</td>
        <td>{{ h.healthRate }}%</td>
        <td>{{ h.careRate }}%</td>
        <td>{{ h.pensionRate }}%</td>
        <td>{{ h.prefectureName }}</td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="insuranceHistoryList.length === 0">履歴なし</div>
</div>
