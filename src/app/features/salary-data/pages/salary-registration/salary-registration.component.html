<!-- 給与・賞与登録画面 -->

<div class="salary-registration-container">
  <div style="margin-bottom: 12px;">
    <div>企業ID：{{ companyDisplayId }}</div>
    <div>企業名：{{ companyName }}</div>
  </div>
  <h2>給与・賞与登録</h2>
  <div class="filter-bar">
    <select [(ngModel)]="selectedYear" (change)="onYearChange()">
      <option *ngFor="let year of years" [value]="year">{{ year }}年度</option>
    </select>
    <select [(ngModel)]="selectedMonth" (change)="onMonthChange()">
      <option *ngFor="let month of months" [value]="month">{{ month }}月</option>
    </select>
    <select [(ngModel)]="selectedBranch" (change)="onBranchChange()">
      <option value="">全支社</option>
      <option *ngFor="let branch of branches" [value]="branch">{{ branch }}</option>
    </select>
    <input type="text" [(ngModel)]="searchKeyword" placeholder="従業員検索">
    <button (click)="onSearch()">🔍</button>
    <button routerLink="/salary-form">給与・賞与登録</button>
  </div>
  <div class="employee-salary-table-wrapper">
    <table class="employee-salary-table">
      <thead>
        <tr>
          <th (click)="sortBy('name')">従業員名</th>
          <th (click)="sortBy('branch')">支社</th>
          <th>基本給</th>
          <th>残業代</th>
          <th>その他手当</th>
          <th>賞与</th>
          <th>総支給額</th>
          <th>登録状態</th>
          <th>編集</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let employee of filteredEmployees">
          <td>{{ employee.name }}</td>
          <td>{{ employee.branch }}</td>
          <td>{{ employee.baseSalary | currency:'JPY':'symbol' }}</td>
          <td>{{ employee.overtime | currency:'JPY':'symbol' }}</td>
          <td>{{ employee.allowance | currency:'JPY':'symbol' }}</td>
          <td>{{ employee.bonus | currency:'JPY':'symbol' }}</td>
          <td>{{ employee.totalSalary | currency:'JPY':'symbol' }}</td>
          <td>{{ employee.status }}</td>
          <td>
            <button (click)="onRegisterSalary(employee)">編集</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="showEditTypeDialog" class="edit-modal-backdrop">
    <div class="edit-modal-dialog">
      <h3>編集種別を選択</h3>
      <div class="edit-type-actions">
        <button (click)="onEditTypeSelect('salary')">給与を修正</button>
        <button (click)="onEditTypeSelect('bonus')">賞与を修正</button>
        <button (click)="onEditCancel()">キャンセル</button>
      </div>
    </div>
  </div>
  <div *ngIf="editMode === 'salary'" class="edit-modal-backdrop">
    <div class="edit-modal-dialog">
      <h3>給与情報編集</h3>
      <form (ngSubmit)="onEditSave()">
        <div class="edit-form-row">
          <label>基本給</label>
          <input type="number" [(ngModel)]="editSalaryForm.basicSalary" name="basicSalary" required>
        </div>
        <div class="edit-form-row">
          <label>時間外手当</label>
          <input type="number" [(ngModel)]="editSalaryForm.overtimeSalary" name="overtimeSalary">
        </div>
        <div class="edit-form-row">
          <label>通勤手当</label>
          <input type="number" [(ngModel)]="editSalaryForm.commuteAllowance" name="commuteAllowance">
        </div>
        <div class="edit-form-row">
          <label>役職手当</label>
          <input type="number" [(ngModel)]="editSalaryForm.positionAllowance" name="positionAllowance">
        </div>
        <div class="edit-form-row">
          <label>その他手当</label>
          <input type="number" [(ngModel)]="editSalaryForm.otherAllowance" name="otherAllowance">
        </div>
        <div class="edit-form-row">
          <label>備考</label>
          <input type="text" [(ngModel)]="editSalaryForm.remarks" name="remarks">
        </div>
        <div class="edit-form-actions">
          <button type="submit">保存</button>
          <button type="button" (click)="onEditCancel()">キャンセル</button>
        </div>
      </form>
    </div>
  </div>
  <div *ngIf="editMode === 'bonus'" class="edit-modal-backdrop">
    <div class="edit-modal-dialog">
      <h3>賞与情報編集</h3>
      <form (ngSubmit)="onEditSave()">
        <div *ngFor="let bonus of editBonusForms; let i = index" class="edit-form-row">
          <label>賞与種類</label>
          <select [(ngModel)]="bonus.bonusType" name="bonusType{{i}}" required>
            <option value="">選択してください</option>
            <option value="年間賞与">年間賞与</option>
            <option value="半年賞与">半年賞与</option>
            <option value="四半期賞与">四半期賞与</option>
            <option value="月次賞与">月次賞与</option>
            <option value="その他賞与">その他賞与</option>
          </select>
          <ng-container *ngIf="bonus.bonusType === 'その他賞与'">
            <label>賞与名</label>
            <input type="text" [(ngModel)]="bonus.bonusName" name="bonusName{{i}}" required>
          </ng-container>
          <label>賞与金額</label>
          <input type="number" [(ngModel)]="bonus.bonus" name="bonus{{i}}">
        </div>
        <div class="edit-form-row">
          <label>備考</label>
          <input type="text" [(ngModel)]="editBonusRemark" name="bonusRemark">
        </div>
        <div class="edit-form-actions">
          <button type="submit">保存</button>
          <button type="button" (click)="onEditCancel()">キャンセル</button>
        </div>
      </form>
    </div>
  </div>
</div>
